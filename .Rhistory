p.trues.5[[3]] <- c(0.07, 0.09, 0.12, 0.15, 0.30)
p.true.5 <- rbind(p.trues.5[[1]],p.trues.5[[2]],p.trues.5[[3]])
p.trues.6 <- list()
p.trues.6[[1]] <- c(0.05, 0.08, 0.10, 0.13, 0.15)
p.trues.6[[2]] <- c(0.09, 0.12, 0.15, 0.30, 0.45)
p.trues.6[[3]] <- c(0.15, 0.30, 0.45, 0.50, 0.60)
p.true.6 <- rbind(p.trues.6[[1]],p.trues.6[[2]],p.trues.6[[3]])
p.trues.7 <- list()
p.trues.7[[1]] <- c(0.07, 0.10, 0.12, 0.15, 0.30)
p.trues.7[[2]] <- c(0.15, 0.30, 0.45, 0.52, 0.60)
p.trues.7[[3]] <- c(0.30, 0.50, 0.60, 0.65, 0.75)
p.true.7 <- rbind(p.trues.7[[1]],p.trues.7[[2]],p.trues.7[[3]])
p.trues.8 <- list()
p.trues.8[[1]] <- c(0.02, 0.10, 0.15, 0.50, 0.60)
p.trues.8[[2]] <- c(0.05, 0.12, 0.30, 0.55, 0.70)
p.trues.8[[3]] <- c(0.08, 0.15, 0.45, 0.60, 0.80)
p.true.8 <- rbind(p.trues.8[[1]],p.trues.8[[2]],p.trues.8[[3]])
p.trues.9 <- list()
p.trues.9[[1]] <- c(0.005, 0.01, 0.02, 0.04, 0.07)
p.trues.9[[2]] <- c(0.02, 0.05, 0.08, 0.12, 0.15)
p.trues.9[[3]] <- c(0.15, 0.30, 0.45, 0.55, 0.65)
p.true.9 <- rbind(p.trues.9[[1]],p.trues.9[[2]],p.trues.9[[3]])
p.trues.10 <- list()
p.trues.10[[1]] <- c(0.05, 0.10, 0.15, 0.30, 0.45)
p.trues.10[[2]] <- c(0.45, 0.50, 0.60, 0.65, 0.70)
p.trues.10[[3]] <- c(0.70, 0.75, 0.80, 0.85, 0.90)
p.true.10 <- rbind(p.trues.10[[1]],p.trues.10[[2]],p.trues.10[[3]])
n.MTD <- 0
for (i in 1:1000){
res <- CFO.simu.fn(target, p.true.5, ncohort=ncohort, cohortsize=cohortsize, init.level.A, init.level.B, add.args=add.args)
if (res$MTD[1]==99 | res$MTD[2]==99){
next
}
if (p.true.5[res$MTD[1],res$MTD[2]] == target){
n.MTD <- n.MTD + 1
}
if (i%%100==0){
message(i)
}
}
n.MTD/1000
p.true.1
p.true.1[3,2]
res$dose.ns
sum(res$dose.ns)
sum(res$DLT.ns)
# n.MTD <- 0
# n.patient <- 0
# n.DLT <- 0
# for (i in 1:1000){
#   res <- CFO.simu.fn(target, p.true.1, ncohort=ncohort, cohortsize=cohortsize, init.level.A, init.level.B, add.args=add.args)
#   n.patient <- n.patient + res$dose.ns[3,2] + res$dose.ns[2,3] + res$dose.ns[1,4]
#   n.DLT <- n.DLT + sum(res$DLT.ns)
#   if (res$MTD[1]==99 | res$MTD[2]==99){
#     next
#   }
#   if (p.true.1[res$MTD[1],res$MTD[2]] == target){
#     n.MTD <- n.MTD + 1
#   }
#   if (i%%100==0){
#     message(i)
#   }
# }
cat('scenario 1')
cat('MTD selection rate: ', n.MTD/1000)
cat('number of patients at the MTD: ', n.patient/(1000*60))
# n.MTD <- 0
# n.patient <- 0
# n.DLT <- 0
# for (i in 1:1000){
#   res <- CFO.simu.fn(target, p.true.1, ncohort=ncohort, cohortsize=cohortsize, init.level.A, init.level.B, add.args=add.args)
#   n.patient <- n.patient + res$dose.ns[3,2] + res$dose.ns[2,3] + res$dose.ns[1,4]
#   n.DLT <- n.DLT + sum(res$DLT.ns)
#   if (res$MTD[1]==99 | res$MTD[2]==99){
#     next
#   }
#   if (p.true.1[res$MTD[1],res$MTD[2]] == target){
#     n.MTD <- n.MTD + 1
#   }
#   if (i%%100==0){
#     message(i)
#   }
# }
cat('scenario 1', '\n')
cat('MTD selection rate: ', n.MTD/1000)
cat('number of patients at the MTD: ', n.patient/(1000*60))
n.MTD <- 0
n.patient <- 0
n.DLT <- 0
for (i in 1:1000){
res <- CFO.simu.fn(target, p.true.1, ncohort=ncohort, cohortsize=cohortsize, init.level.A, init.level.B, add.args=add.args)
n.patient <- n.patient + res$dose.ns[3,2] + res$dose.ns[2,3] + res$dose.ns[1,4]
n.DLT <- n.DLT + sum(res$DLT.ns)
if (res$MTD[1]==99 | res$MTD[2]==99){
next
}
if (p.true.1[res$MTD[1],res$MTD[2]] == target){
n.MTD <- n.MTD + 1
}
if (i%%100==0){
message(i)
}
}
cat('scenario 1', '\n')
cat('MTD selection rate: ', n.MTD/1000, '\n')
cat('number of patients at the MTD: ', n.patient/(1000*60), '\n')
cat('average number of DLTs: ', n.DLT/1000)
make.decision.2dCFO.fn <- function(phi, cys, cns, alp.prior, bet.prior, cover.doses, diag=FALSE){
cidx.A <- 0
cidx.B <- 0
# horizontal direction
# message(paste('cys[2,]: ', cys[2,]))
# message(paste('cns[2,]: ', cns[2,]))
idx.chg.A <- make.decision.1dCFO.fn(phi, cys[2,], cns[2,], alp.prior, bet.prior, cover.doses[2,]) - 2
# message(paste('decision A: ',idx.chg.A))
# vertical direction
# message(paste('cys[,2]: ', cys[,2]))
# message(paste('cns[,2]: ', cns[,2]))
# message(paste('alp, bet: ', alp.prior, bet.prior))
# message(paste('cover.doses: ',cover.doses[,2]))
idx.chg.B <- make.decision.1dCFO.fn(phi, cys[,2], cns[,2], alp.prior, bet.prior, cover.doses[,2]) - 2
# message(paste('decision B: ',idx.chg.B))
if (idx.chg.A == 1 & idx.chg.B == 1){
### horizontal and vertical only
OR.R <- OR.values(phi, cys[2,2], cns[2,2], cys[2,3], cns[2,3], alp.prior, bet.prior, type="R")
OR.U <- OR.values(phi, cys[2,2], cns[2,2], cys[3,2], cns[3,2], alp.prior, bet.prior, type="R")
# message(paste('OR.R: ',OR.R))
# message(paste('OR.U: ',OR.U))
if (OR.R == OR.U){
rand <- rbinom(1,1,0.5)
if(rand == 0){
cidx.A <- 1
} else {
cidx.B <- 1
}
} else if (OR.R > OR.U){
cidx.B <- 1
} else {
cidx.A <- 1
}
### diagonal direction
# cidx.A <- idx.chg.A
# cidx.B <- idx.chg.B
} else if (idx.chg.A == -1 & idx.chg.B == -1){
if (is.na(cys[2,1]) & is.na(cys[1,2])){
cidx.A <- 0
cidx.B <- 0
} else if (is.na(cys[2,1])){
cidx.A <- -1
} else if (is.na(cys[1,2])){
cidx.B <- -1
} else {
OR.L <- OR.values(phi, cys[2,2], cns[2,2], cys[2,1], cns[2,1], alp.prior, bet.prior, type="L")
OR.D <- OR.values(phi, cys[2,2], cns[2,2], cys[1,2], cns[1,2], alp.prior, bet.prior, type="L")
if (OR.L == OR.D){
rand <- rbinom(1,1,0.5)
if(rand == 0){
cidx.A <- -1
} else {
cidx.B <- -1
}
} else if (OR.L > OR.D){
cidx.B <- -1
} else {
cidx.A <- -1
}
}
} else if (idx.chg.A == 1 & idx.chg.B == -1){
message('rare case occurs')
DCR <- make.decision.1dCFO.fn(phi, c(cys[1,2],cys[2,2],cys[2,3]), c(cns[1,2],cns[2,2],cns[2,3]), alp.prior,
bet.prior, c(cover.doses[1,2],cover.doses[2,2],cover.doses[2,3])) - 2
if (DCR == 1){
cidx.B <- 1
} else if (DCR == -1){
cidx.A <- -1
}
} else if (idx.chg.A == -1 & idx.chg.B == 1){
# message('rare case occurs')
LCU <- make.decision.1dCFO.fn(phi, c(cys[2,1],cys[2,2],cys[3,2]), c(cns[2,1],cns[2,2],cns[3,2]), alp.prior,
bet.prior, c(cover.doses[2,1],cover.doses[2,2],cover.doses[3,2])) - 2
if (LCU == 1){
cidx.A <- 1
} else if (LCU == -1){
cidx.B <- -1
}
} else if (idx.chg.A == 1 & idx.chg.B == 0){
cidx.B <- 1
} else if (idx.chg.A == 0 & idx.chg.B == 1){
cidx.A <- 1
} else if (idx.chg.A == -1 & idx.chg.B == 0){
cidx.B <- -1
} else if (idx.chg.A == 0 & idx.chg.B == -1){
cidx.A <- -1
}
return (c(cidx.A, cidx.B))
}
source("C:/Users/User/Desktop/2D-CFO/2D_CFO_MTD.R", echo=TRUE)
n.MTD <- 0
n.patient <- 0
n.DLT <- 0
for (i in 1:1000){
res <- CFO.simu.fn(target, p.true.1, ncohort=ncohort, cohortsize=cohortsize, init.level.A, init.level.B, add.args=add.args)
n.patient <- n.patient + res$dose.ns[3,2] + res$dose.ns[2,3] + res$dose.ns[1,4]
n.DLT <- n.DLT + sum(res$DLT.ns)
if (res$MTD[1]==99 | res$MTD[2]==99){
next
}
if (p.true.1[res$MTD[1],res$MTD[2]] == target){
n.MTD <- n.MTD + 1
}
if (i%%100==0){
message(i)
}
}
cat('scenario 1', '\n')
cat('MTD selection rate: ', n.MTD/1000, '\n')
cat('% of patients at the MTD: ', n.patient/(1000*60), '\n')
cat('average number of DLTs: ', n.DLT/1000)
make.decision.2dCFO.fn <- function(phi, cys, cns, alp.prior, bet.prior, cover.doses, diag=FALSE){
cidx.A <- 0
cidx.B <- 0
# horizontal direction
# message(paste('cys[2,]: ', cys[2,]))
# message(paste('cns[2,]: ', cns[2,]))
idx.chg.A <- make.decision.1dCFO.fn(phi, cys[2,], cns[2,], alp.prior, bet.prior, cover.doses[2,]) - 2
# message(paste('decision A: ',idx.chg.A))
# vertical direction
# message(paste('cys[,2]: ', cys[,2]))
# message(paste('cns[,2]: ', cns[,2]))
# message(paste('alp, bet: ', alp.prior, bet.prior))
# message(paste('cover.doses: ',cover.doses[,2]))
idx.chg.B <- make.decision.1dCFO.fn(phi, cys[,2], cns[,2], alp.prior, bet.prior, cover.doses[,2]) - 2
# message(paste('decision B: ',idx.chg.B))
if (idx.chg.A == 1 & idx.chg.B == 1){
### horizontal and vertical only
OR.R <- OR.values(phi, cys[2,2], cns[2,2], cys[2,3], cns[2,3], alp.prior, bet.prior, type="R")
OR.U <- OR.values(phi, cys[2,2], cns[2,2], cys[3,2], cns[3,2], alp.prior, bet.prior, type="R")
# message(paste('OR.R: ',OR.R))
# message(paste('OR.U: ',OR.U))
if (OR.R == OR.U){
rand <- rbinom(1,1,0.5)
if(rand == 0){
cidx.A <- 1
} else {
cidx.B <- 1
}
} else if (OR.R > OR.U){
cidx.B <- 1
} else {
cidx.A <- 1
}
### diagonal direction
# cidx.A <- idx.chg.A
# cidx.B <- idx.chg.B
} else if (idx.chg.A == -1 & idx.chg.B == -1){
if (is.na(cys[2,1]) & is.na(cys[1,2])){
cidx.A <- 0
cidx.B <- 0
} else if (is.na(cys[2,1])){
cidx.A <- -1
} else if (is.na(cys[1,2])){
cidx.B <- -1
} else {
OR.L <- OR.values(phi, cys[2,2], cns[2,2], cys[2,1], cns[2,1], alp.prior, bet.prior, type="L")
OR.D <- OR.values(phi, cys[2,2], cns[2,2], cys[1,2], cns[1,2], alp.prior, bet.prior, type="L")
if (OR.L == OR.D){
rand <- rbinom(1,1,0.5)
if(rand == 0){
cidx.A <- -1
} else {
cidx.B <- -1
}
} else if (OR.L > OR.D){
cidx.B <- -1
} else {
cidx.A <- -1
}
}
} else if (idx.chg.A == 1 & idx.chg.B == -1){
# message('rare case occurs')
DCR <- make.decision.1dCFO.fn(phi, c(cys[1,2],cys[2,2],cys[2,3]), c(cns[1,2],cns[2,2],cns[2,3]), alp.prior,
bet.prior, c(cover.doses[1,2],cover.doses[2,2],cover.doses[2,3])) - 2
if (DCR == 1){
cidx.B <- 1
} else if (DCR == -1){
cidx.A <- -1
}
} else if (idx.chg.A == -1 & idx.chg.B == 1){
# message('rare case occurs')
LCU <- make.decision.1dCFO.fn(phi, c(cys[2,1],cys[2,2],cys[3,2]), c(cns[2,1],cns[2,2],cns[3,2]), alp.prior,
bet.prior, c(cover.doses[2,1],cover.doses[2,2],cover.doses[3,2])) - 2
if (LCU == 1){
cidx.A <- 1
} else if (LCU == -1){
cidx.B <- -1
}
} else if (idx.chg.A == 1 & idx.chg.B == 0){
cidx.B <- 1
} else if (idx.chg.A == 0 & idx.chg.B == 1){
cidx.A <- 1
} else if (idx.chg.A == -1 & idx.chg.B == 0){
cidx.B <- -1
} else if (idx.chg.A == 0 & idx.chg.B == -1){
cidx.A <- -1
}
return (c(cidx.A, cidx.B))
}
source("C:/Users/User/Desktop/2D-CFO/2D_CFO_MTD.R", echo=TRUE)
n.MTD <- 0
n.patient <- 0
n.DLT <- 0
for (i in 1:1000){
res <- CFO.simu.fn(target, p.true.1, ncohort=ncohort, cohortsize=cohortsize, init.level.A, init.level.B, add.args=add.args)
n.patient <- n.patient + res$dose.ns[3,2] + res$dose.ns[2,3] + res$dose.ns[1,4]
n.DLT <- n.DLT + sum(res$DLT.ns)
if (res$MTD[1]==99 | res$MTD[2]==99){
next
}
if (p.true.1[res$MTD[1],res$MTD[2]] == target){
n.MTD <- n.MTD + 1
}
if (i%%100==0){
message(i)
}
}
cat('scenario 1', '\n')
cat('MTD selection rate: ', n.MTD/1000, '\n')
cat('% of patients at the MTD: ', n.patient/(1000*60), '\n')
cat('average number of DLTs: ', n.DLT/1000)
n.MTD <- 0
n.patient <- 0
n.DLT <- 0
for (i in 1:1000){
res <- CFO.simu.fn(target, p.true.2, ncohort=ncohort, cohortsize=cohortsize, init.level.A, init.level.B, add.args=add.args)
n.patient <- n.patient + res$dose.ns[1,2] + res$dose.ns[2,1]
n.DLT <- n.DLT + sum(res$DLT.ns)
if (res$MTD[1]==99 | res$MTD[2]==99){
next
}
if (p.true.2[res$MTD[1],res$MTD[2]] == target){
n.MTD <- n.MTD + 1
}
if (i%%100==0){
message(i)
}
}
cat('scenario 2', '\n')
cat('MTD selection rate: ', n.MTD/1000, '\n')
cat('number of patients at the MTD: ', n.patient/(1000*60), '\n')
cat('average number of DLTs: ', n.DLT/1000)
n.MTD <- 0
n.patient <- 0
n.DLT <- 0
for (i in 1:1000){
res <- CFO.simu.fn(target, p.true.3, ncohort=ncohort, cohortsize=cohortsize, init.level.A, init.level.B, add.args=add.args)
n.patient <- n.patient + res$dose.ns[3,3] + res$dose.ns[2,4] + res$dose.ns[1,5]
n.DLT <- n.DLT + sum(res$DLT.ns)
if (res$MTD[1]==99 | res$MTD[2]==99){
next
}
if (p.true.3[res$MTD[1],res$MTD[2]] == target){
n.MTD <- n.MTD + 1
}
if (i%%100==0){
message(i)
}
}
cat('scenario 3', '\n')
cat('MTD selection rate: ', n.MTD/1000, '\n')
cat('number of patients at the MTD: ', n.patient/(1000*60), '\n')
cat('average number of DLTs: ', n.DLT/1000)
n.MTD <- 0
n.patient <- 0
n.DLT <- 0
for (i in 1:1000){
res <- CFO.simu.fn(target, p.true.5, ncohort=ncohort, cohortsize=cohortsize, init.level.A, init.level.B, add.args=add.args)
if (res$MTD[1]==99 | res$MTD[2]==99){
next
}
if (p.true.5[res$MTD[1],res$MTD[2]] == target){
n.MTD <- n.MTD + 1
}
if (i%%100==0){
message(i)
}
}
cat('scenario 5', '\n')
cat('MTD selection rate: ', n.MTD/1000, '\n')
cat('number of patients at the MTD: ', n.patient/(1000*60), '\n')
cat('average number of DLTs: ', n.DLT/1000)
n.MTD <- 0
n.patient <- 0
n.DLT <- 0
for (i in 1:1000){
res <- CFO.simu.fn(target, p.true.6, ncohort=ncohort, cohortsize=cohortsize, init.level.A, init.level.B, add.args=add.args)
n.patient <- n.patient + res$dose.ns[3,2] + res$dose.ns[2,4]
n.DLT <- n.DLT + sum(res$DLT.ns)
if (res$MTD[1]==99 | res$MTD[2]==99){
next
}
if (p.true.6[res$MTD[1],res$MTD[2]] == target){
n.MTD <- n.MTD + 1
}
if (i%%100==0){
message(i)
}
}
cat('scenario 6', '\n')
cat('MTD selection rate: ', n.MTD/1000, '\n')
cat('number of patients at the MTD: ', n.patient/(1000*60), '\n')
cat('average number of DLTs: ', n.DLT/1000)
n.MTD <- 0
n.patient <- 0
n.DLT <- 0
for (i in 1:1000){
res <- CFO.simu.fn(target, p.true.7, ncohort=ncohort, cohortsize=cohortsize, init.level.A, init.level.B, add.args=add.args)
n.patient <- n.patient + res$dose.ns[3,1] + res$dose.ns[2,2] + res$dose.ns[1,5]
n.DLT <- n.DLT + sum(res$DLT.ns)
if (res$MTD[1]==99 | res$MTD[2]==99){
next
}
if (p.true.7[res$MTD[1],res$MTD[2]] == target){
n.MTD <- n.MTD + 1
}
if (i%%100==0){
message(i)
}
}
cat('scenario 7', '\n')
cat('MTD selection rate: ', n.MTD/1000, '\n')
cat('number of patients at the MTD: ', n.patient/(1000*60), '\n')
cat('average number of DLTs: ', n.DLT/1000)
n.MTD <- 0
n.patient <- 0
n.DLT <- 0
for (i in 1:1000){
res <- CFO.simu.fn(target, p.true.8, ncohort=ncohort, cohortsize=cohortsize, init.level.A, init.level.B, add.args=add.args)
n.patient <- n.patient + res$dose.ns[2,3]
n.DLT <- n.DLT + sum(res$DLT.ns)
if (res$MTD[1]==99 | res$MTD[2]==99){
next
}
if (p.true.8[res$MTD[1],res$MTD[2]] == target){
n.MTD <- n.MTD + 1
}
if (i%%100==0){
message(i)
}
}
cat('scenario 8', '\n')
cat('MTD selection rate: ', n.MTD/1000, '\n')
cat('number of patients at the MTD: ', n.patient/(1000*60), '\n')
cat('average number of DLTs: ', n.DLT/1000)
n.MTD <- 0
n.patient <- 0
n.DLT <- 0
for (i in 1:1000){
res <- CFO.simu.fn(target, p.true.9, ncohort=ncohort, cohortsize=cohortsize, init.level.A, init.level.B, add.args=add.args)
n.patient <- n.patient + res$dose.ns[3,2]
n.DLT <- n.DLT + sum(res$DLT.ns)
if (res$MTD[1]==99 | res$MTD[2]==99){
next
}
if (p.true.9[res$MTD[1],res$MTD[2]] == target){
n.MTD <- n.MTD + 1
}
if (i%%100==0){
message(i)
}
}
cat('scenario 9', '\n')
cat('MTD selection rate: ', n.MTD/1000, '\n')
cat('number of patients at the MTD: ', n.patient/(1000*60), '\n')
cat('average number of DLTs: ', n.DLT/1000)
n.MTD <- 0
n.patient <- 0
n.DLT <- 0
for (i in 1:1000){
res <- CFO.simu.fn(target, p.true.10, ncohort=ncohort, cohortsize=cohortsize, init.level.A, init.level.B, add.args=add.args)
n.patient <- n.patient + res$dose.ns[1,4]
n.DLT <- n.DLT + sum(res$DLT.ns)
if (res$MTD[1]==99 | res$MTD[2]==99){
next
}
if (p.true.10[res$MTD[1],res$MTD[2]] == target){
n.MTD <- n.MTD + 1
}
if (i%%100==0){
message(i)
}
}
cat('scenario 10', '\n')
cat('MTD selection rate: ', n.MTD/1000, '\n')
cat('number of patients at the MTD: ', n.patient/(1000*60), '\n')
cat('average number of DLTs: ', n.DLT/1000)
n.MTD <- 0
n.patient <- 0
n.DLT <- 0
for (i in 1:1000){
res <- CFO.simu.fn(target, p.true.4, ncohort=ncohort, cohortsize=cohortsize, init.level.A, init.level.B, add.args=add.args)
n.patient <- n.patient + res$dose.ns[1,1]
n.DLT <- n.DLT + sum(res$DLT.ns)
if (res$MTD[1]==99 | res$MTD[2]==99){
next
}
if (p.true.4[res$MTD[1],res$MTD[2]] == target){
n.MTD <- n.MTD + 1
}
if (i%%100==0){
message(i)
}
}
