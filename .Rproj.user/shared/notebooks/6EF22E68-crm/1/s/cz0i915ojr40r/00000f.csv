"0","crm<-function(obs,alpha,prior.o,theta){"
"0","  "
"0","  sim<<-table(obs$level,obs$tox)"
"0","  ifelse(dim(sim)[2]==1,sim1<<-data.frame(as.numeric(row.names(sim)),sim[,1],1-sim[,1]),sim1<<-data.frame(as.numeric(row.names(sim)),sim[,1],sim[,2]))"
"0","  names(sim1)<<-c('level','nontox','tox')"
"0","  "
"0","  apred<<-rep(0,s)"
"0","  lik<<-rep(0,s)"
"0","  for(k in 1:s){			"
"0","    ll<-function(a){"
"0","      la<-0 #value of the log-likelihood"
"0","      for(i in sim1$level){"
"0","        index<-match(i,sim1$level)"
"0","        la<-la+sim1$tox[index]*a*log(alpha[k,][i])+sim1$nontox[index]*log((1-alpha[k,][i]**a))"
"0","      }"
"0","      la"
"0","    }"
"0","    apred[k]<<-optimize(f=ll,interval=c(0,100),maximum=T)$maximum"
"0","    lik[k]<<-ll(apred[k])"
"0","  }"
"0","  pord<<-(exp(lik)*prior.o)/sum(exp(lik)*prior.o)"
"0","  ord<<-which.is.max(pord)"
"0","  ahat<<-apred[ord]"
"0","  rpred<<-alpha[ord,]**ahat"
"0","  next.lev<<-which.is.max(-(abs(rpred-theta)))"
"0","  next.lev"
"0","}"
