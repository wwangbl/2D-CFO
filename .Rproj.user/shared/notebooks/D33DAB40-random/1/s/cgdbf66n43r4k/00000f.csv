"0","gen.rand.doses <- function(ndose, target, mu1=0.55, mu2=0.55, inv.fn=qnorm, fn=pnorm, MTD=NA){"
"0","    sigma0 <- 0.05"
"0","    sigma1 <- 0.35"
"0","    sigma2 <- 0.35"
"0","    raw.p.trues <- rep(0, ndose)"
"0","    if (is.na(MTD)){"
"0","        mtd.level <- sample.int(ndose, 1)"
"0","    }else{"
"0","        mtd.level <- MTD"
"0","    }"
"0","    "
"0","    raw.p.trues[mtd.level] <- rnorm(1, inv.fn(target), sigma0)"
"0","    "
"0","    if (mtd.level != 1){"
"0","        eps.minus <- rnorm(1, mu1, sigma1)"
"0","        if (raw.p.trues[mtd.level] > inv.fn(target)){"
"0","            dlt <- raw.p.trues[mtd.level] - inv.fn(2*target-fn(raw.p.trues[mtd.level]))"
"0","        }else{"
"0","            dlt <- 0 "
"0","        }"
"0","        raw.p.trues[mtd.level-1] <- raw.p.trues[mtd.level] - (dlt +  eps.minus**2)"
"0","    }"
"0","    "
"0","    if (mtd.level != ndose){"
"0","        eps.plus <- rnorm(1, mu2, sigma2)"
"0","        if (raw.p.trues[mtd.level] < inv.fn(target)){"
"0","            dlt <- inv.fn(2*target-fn(raw.p.trues[mtd.level])) - raw.p.trues[mtd.level]"
"0","        }else{"
"0","            dlt <- 0 "
"0","        }"
"0","        raw.p.trues[mtd.level+1] <- raw.p.trues[mtd.level] + (dlt +  eps.plus**2)"
"0","    }"
"0","    "
"0","    if ((mtd.level-2)>0){"
"0","        for (i in (mtd.level-2):1){"
"0","           eps.minus <- rnorm(1, mu1, sigma1)"
"0","           raw.p.trues[i]  <- raw.p.trues[i+1] - eps.minus**2"
"0","        }"
"0","    }"
"0","    if ((mtd.level+2)<=ndose){"
"0","        for (j in (mtd.level+2):ndose){"
"0","           eps.plus <- rnorm(1, mu2, sigma2)"
"0","           raw.p.trues[j] <- raw.p.trues[j-1] + eps.plus**2"
"0","        }"
"0","    }"
"0","    p.trues <- fn(raw.p.trues)"
"0","    list(p.trues=p.trues, mtd.level=mtd.level)"
"0","}"
"0",""
